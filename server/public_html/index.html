<!DOCTYPE html>
<html>
  <head>
    <title>D3 - Line Chart - axes and grid using axis()</title>
    <!-- script type="text/javascript" src="https://raw.github.com/jquery/sizzle/master/sizzle.js"></script -->
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.min.js"></script>
    <style type="text/css">

	body {
	  font: 10px sans-serif;
	}

	.rules line, .rules path {
	  shape-rendering: crispEdges;
	  stroke: #000;
	}

	.rules .tick {
	}
	.rules .minor {
	  stroke: #BBB;
	}
	.rules .domain {
	  fill: none;
	}

	.grid .tick {
	  stroke: #CCC;
	}

    </style>
  </head>
  <body>
	  
	<div id="graph"></div>
	  
<script type="text/javascript">
		
d3.text("/public_html/data.csv", function(unparsedData) {
		
	var dataset = d3.csv.parseRows(unparsedData);
	var barPadding = 0;
	
	var w = 760;
	var h = 400;
	var pad = 50;

	var d = new Date();
	var n = d.getTime();
	var date2 = new Date(n);

	var minDate = d3.min(dataset, function(d) { 
		return d[0]; 
	});
	var maxDate = d3.max(dataset, function(d) { return d[0]; });

	console.log("Min: "+minDate);
	console.log("Max: "+maxDate);

	var minTemp = d3.min(dataset, function(d) { return d[1]; });
	var maxTemp = d3.max(dataset, function(d) { return d[1]; });

	var xScale = d3.scale.linear().domain([minDate, maxDate]).range([0,w]);
	var yScale = d3.scale.linear().domain([minTemp, maxTemp]).range([h,0]);

	var svg = d3.select("body")
	    .append("svg:svg")
	    .attr("height", h + pad)
	    .attr("width",  w + pad)

	// lines container
	var vis = svg.append("svg:g")
	    .attr("transform", "translate(40,20)")
	var rules = vis.append("svg:g").classed("rules", true)

	function make_x_axis() {
	  return d3.svg.axis()
	      .scale(xScale)
	      .orient("bottom")
	      .ticks(8)
	}

	function make_y_axis() {
	  return d3.svg.axis()
	      .scale(yScale)
	      .orient("left")
	      .ticks(10)
	}

	rules.append("svg:g").classed("grid x_grid", true)
	    .attr("transform", "translate(0,"+h+")")
	    .call(make_x_axis()
	      .tickSize(-h,0,0)
	      .tickFormat("")
	    )

	rules.append("svg:g").classed("grid y_grid", true)
	    .call(make_y_axis()
	      .tickSize(-w,0,0)
	      .tickFormat("")
//		  .tickFormat(d3.format(",.0f"))
	    )

	rules.append("svg:g").classed("labels x_labels", true)
	    .attr("transform", "translate(0,"+h+")")
	    .call(make_x_axis()
	      .tickSize(5)
	      //.tickFormat(d3.time.format("%Y/%m"))
	    )

	rules.append("svg:g").classed("labels y_labels", true)
	    .call(make_y_axis()
	      .tickSubdivide(1)
	      .tickSize(10, 5, 0)
	    )

		
	// create bars
	svg.append("svg:g").classed("bar_chart container", true)
		.attr("transform", "translate(40,0)")
		.selectAll("rect")
		.data(dataset)
		.enter()
		.append("rect")
		.attr("fill", "#cccccc")
		.style("opacity", 0.9)
		.attr("x", function(d,i) {
			return xScale(d[0]);
		})
		.attr("y", function(d,i) {
			// return ( 10*i );
			return ( h - yScale(d[1]) + 20 );
		})
		.attr("width", function(d,i) {
			return ( w / dataset.length  );
		})
		.attr("height", function(d,i) {
			return yScale(d[1]);						
		});
/*
	svg.selectAll("text")
		.data(dataset)
		.enter()
		.attr("text-anchor", "top")
		.attr("x", function(d,i) {
			return xScale(d[0]);
		})
		.text(function(d) {
			return d[0];
		});
 */


}); // end .text

		
    </script>
  </body>
</html>
